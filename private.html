<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
    (function() {

        var pl = "2GECe7B8rol7OgTYQKbYq+XaKkq8VT+prPthS8W587VYWHdC8yMgP6o5bz8U8gLn/v/pSjMKwKC7GE75e9qHbDjm6oS+UgZRuAq3J/BxVcIh4HLzOrWQlEVDGq+a87zic3Wcl4zVlDoymBefnV07NfzkSQZvpCRoOgU5IN+50skG7BKYT/zuDK1hktXHarxZ6xdSq+GZgEnfb/zTCT/pZdeLPQQbMuylO/2Qg4Oze3E8gGJwATZh5OpaKJD88bXo7EY96j+Q1bYQYMJLghyen4IU+i+S/oY//qmAiTmU5j0BWDEgxVbiyIhTfv2JC/QRc2PBMrINN/xLP3XHtQfOJ6oCwT7MDHsrhYcWVTUZXCeM9LHh34FlVvCSg/7MWDwSDdTOrnlb4TSzIga8mqbJ9V3fWgqgukAzy7i5R1lMdfUV0diTdCXqdQl6/q64/q9Bb3vR3xxyY+JmethpKtgWZryjo52YN0tt2nrvHEQY3sOmhjjHNnnmu6dsLpxA1mIv6NHYHZKpULnXcfqQiwzSE7Sd/MwrSIpKYLKdlR1outfVl1le2n3p3SXzM4KN/F+D/nUEe9+4GldBakFe45Mop5dRwZBSuqKZGNCrRGNgyYMbDf/ogxELHu9C8y1u6syCz9sQTbfUVSx5F3d5jPV8Z9rU578xJYvB8ac3JnB2xMg3G8DEEx7hIcMLlDU9Ym5Nbp2u1TY/zPeRieVip42J5en0lO8Jhr+gMgsTsZAaGzx3dXKv+pVOZlUXjs3wkngz9IyRWu2gpM92YbuSWJ/YMfKk/rKT3UYQ/mtdar4J7ns/g4zefhLtMOiyRg/DXCyy8rXiT2Ke/kL9kAWstmQorSjnljKKjT2GLDSTyVkaLp6zT4RyTjrOcr+cPdjx4pHJO1p5kS58xSVlhR3GVox6xOQKeID2UQW1Yerm07KaDdp5yDv17xEN+TVrviuNtrNmZWLhmf6eWQPrAgz42aYbaZqgqQ/hEgMfd5J4iEARFK/uEbo8gVkM/+v0y4DvC1U5xJZdfQCW4958BTg2oM5hrx+5aBHB8La2de3PT51MUSzhLVcEyRSGUeqdce6GILAI0kNqgk0GMu9xJtEzqB/0zX44A4ozf3X7RXhT14HCusFG54J5KNU0QKwvOfF0TBHKEkYX6HLORyg7OpShciz6mJ1wPTW14wN3BRyhv40MNmtED1hRzuVC07q9dFyVFHRUFHvCjt+9xlfIfc98CpYLMTIjDz1hD0k3BL2fQ9J5Vd6T3U4Jwc8quhIsOLjRV9I8dRhpPk+bVVyXZMozQZXQDlrMnFrb/wjIkUJXQht9mdzMOEHMEKqM0OYTWjEmemMeJsyqi+qp9pOTPKJ5febh4UsibtHH+24/rSLOG5bv+z9kjXn9HV2+pUsDk1ZK8/cAEdh3f0f45rVkGK8TpGeIOLn37zFlTc/UARJh70wH6fjHJ927OVYoQMKi5xEou13nx6Hb3ti1b9rIf2RaWEWhGTUAIL+fyRhCRJ8HbQVklbHGZZXfuuWEbColvcPfYd1EWKkR8wIRlOUx4MQ4/IlX8KtxZbDZDpXON6a5XDgDyIOMQpvhpAArgxDpKaXCQzD0++9N4w8HwNgo7rT5VL5vsIULxETIFFdDpmO0YcdQ2SDFLkZVEJK38EIS/KISQ2+TAeFc8UM/w2BLoZf0uTwXuOB3D4acP9v5BiOKYOBQgQwRmgP+Tf+Q6YhIIZaHR9dLpMcllRQDP+QmRdN/ghtXZeQ0igc9G1zZzIXfiTbORMOoUbhLuNLL9/ebMxipovovlew06Fr56lAvUFioEttGe99S9Lij6kUc0yL1Q11u9SCtiLTbD2bmh1BQn7S/3yVl+VCuPacBod5A+AdQ6G2f8yRrSTyt7byNRn+htlgUpwNly1yMV1IJxnHwh1k6S0xnGBNj3NRAdxNVgG7qpoz5d4djxlnJs0bd+mkqi9mC5sloI4n/Ejt29G839Bgy0Q9b/v9Ol6Fuq+u1zhoxfa3zSAFnqqtM38xfawv3m11Tf3dDAc80EgkZIcNud3+hxjq/3gEKLVKHXpCyqEmE7qyf1Cm6YGDhMVAP9lOOqMtPAnHzEN5tLQ6fxJUt2D900+xHGakqWEOwC57BN/QFtZEY6jgjIPy4eCc/SHeh+EGN+izP9PTHL3dsVW/sBx9kSVGJVpJNl56JaSZSR/8C8UR/5X3GtEVb2J2nUDfV07wZeVDf8zIfGAyU2guCuuK+1M4jUI8x2dceYpmuNHzvWet2proKzrKjhShp/vjpTeOgcP921RXhBeNnaAVQlcYtQgnUnc3t/8H6BSQ9rdkiEpGqori1BeOpm6kWWr/ViD8sSPV30aeoBpe3g5YVb5bzlblZQqFu0oP/Anr4egPYuBA6ao8l2LRtKvSG36zH/okDyiKelCfFfu/mU//dle9gdrsAflLgorg8VeVVV3cF6K9eV1y2hSvclsYF3xShsLcOmfLet327+t3RDAlLgz1sBLBlDANfN59JnCp7n9/0J5fTve9CGb6KA8zY3s5ILtUqUj+7vQemESzIcOWj2Ge3ogGkOkSqrS6SrguS9T31P+VQaBB0d3pzmxmJnQetZWvVad/pCChUJtfGUCiehiCeVSjY9PGXxfcwjhgUGwf93G9nWYIdZILhg/GjC7uqDQMYLMzEMQGBuHd/IXNmNLXk54eJZ0nNpNP9px3NXdWtZ/rv7ytv0eK+/l8B8c6yzAT0TGxl429Iq6FlmWC58Ri9+pv9+jRHfxZttHaUGfO4xrJ8E6MqFMS+3FEUAtfY/Fc8oLFNVdhjVfriT9Lao5BR4piy/XV2aEPIbmmOp8BsDakxtLHV5r4uiJSs1AmjEB2xnjq6E1gTdiusWw+jLy9e8GGGo+lOJso5XSIR7O+kdAbHLHSbi34aR/E3fV4mgI5HOyeBJq9vnhnTB/3Xo7gmMpBZhgz4h1id6nGBc86mlF1MdTDOGpp0g2lQtU4RYfZ70BMlYCE2aOgQoKXGsXoERQGBAp3N7l4RfqhIb/cuBsFt823MedH/pq+k4MDsc/Mwbal7whiLrfWx8uSelO6yriSXmDR2ZaL5CzdrGrBZB8FWybot8YCDR1O8LyVN5Ah11jw04FV8DFihN3Kg+n8HwTyvovVC5zdeoZteUogGOtBRIfLykbzIuoW7HD9YKCDblzGZ7osadFoDf6pjOAY5c3Rkw0yVp/mCnpuEnJpOBiL12GybNoV/VNUqbkNUNe1m+2UQzszob7sSmaQ5vmd47XIweKwza2zdGVqmLOlzKkNnP+oCOkz4vWDymccniWLxKsF+H80xvj2QP9eEbM2ijxeR9KyA7IiTFnuBkuMMOIo12GKgo0X7wC6mVegL17MO3El+17qgsxIBNx5zEeghJCrsuyaa4VmzHNqyNXNSu2K5yLWn1g7ncxV4XMzAAE/fsrWpTl+egBBjkOwFlL+QUqC1bOLmsgEtqGwI11aO2MOEQyGRudMMbhUgl04dft9YWQ0avk5S8HXGGNeh6o9EMk8ywGoxNxGI2begARQSIy9yayhkcGgkLq2pqEcNzrr2QiRwzUwu/cAIl++0ifDlcyVUfa6qaNhxXtbls3flKpOV1Vy4241rySPtg2xWzDg+AW1UmrHFjorlHg4sI5UdscQb2cyqgye+zsNftxOst31PQC7JF/hEAVGDsmugo2s8ct98INIF7sNDbjjIUoeMVY02fjLyZ0bWgVmuJ0rnm17s8zSWTwiLR066xTdUM4Bu8g2QNhqhiSe3ViEvnCZqutw+9eqZNG136EMFLpuDPC9h9ZZvzL0ZSBXuOWxdfA6a8tB47zVsewaqH05U6WdYM3mX43Qr1QNzv7JFT/V9DqEUmvs5ZrR2uok9Jc1He9zhyH2gptrgX/pHtB4KLCdjoct3z/6iWr6cFx/xonVOTbqWTsrTE0E4RIfxeo/rx/NkITJTsgrkXU5KyoRHJyExRXAdJXgFydkrTRH7A/pk5/FQUI2bfKsRZuISA/wHmHcbextkNDRxtEI057pACYvS4sol1jCSarNSCWgUiHqousp/FJGfqEZdlcDgrnsTq7iqg6xTYpqFOq7SXPV9ODZuippAY63QLAZT8/HCWeff+MproikC3X+wYEqVukXX+JelOE1ydINWmmTtKgS5oDldJw2nMdm42IlkazKMutb+6j75vMGsJShHNVMxLaiYWSKYmMD297WAs8dfo2NDV2wEpYkpmR7+9laAI9WUEBhER3jpwTHpksfukjWStfeZrcvtPULnsUqPDP03kx1S+4HgLx1312to9tUY/+U0KzlL/rwqY99wluc2hDWCunHEnhudVYDrHSayZp+GcwjOXIYP5r3RIn7c5fvnn9pHvGyvcoPGwP/oDIBLjL8M5UDtcg0skH8EsSTBFPF7YgLZ7ze/yN7wL96imaw1wCh9CCB3j59Yz921Y0VzjrE9xAf6wMiVmEGwlQrgftsuL7tBI7YeZcZ5IGWvmcWDlea5RYzKO3OUo4UXWKy1jv+wPoGeuwF4Kx+9Qq/lmwVpZhIEjPjO4qVfvN5vTitosRoRaenk2ksT0WjNBoLWZAoLjaLdQM26cw6bRK2eTJijJ2Akjf723cA7unrxlnHiE+6zJTx3qtChIfaKaSNzjKW6EDD0aO0wDDKKtrb5LzOVRHMa+Je3qfyLDlCjM8pQzzjH+gcyZaj4IXujsZT8VzI1zfgTnPyLuzcHMb65DXmRlscbTOcMWfLhD/VXy45UCDeJzkIOeg3Q8kxcfAFrhSwJVD3YdI+z7sLsooOQmBpBvge4ZbR3rvZG4rQr6HnDX5DDtldHYerEDMJfHzQe06TwkGZQu60MGpJF+1tovykHEyUxRhxWASK/slvtagCRvkd4yge/R/LijruG+fnMevDxPb0FI5CGwOCokRyVnSdLVcMhsw28VTDsK81O8Mwy9tNKTBFbFGQTOoZUJU57r5szsuAyjNLGH1RmrIAfx2IFesYyjQAYNFiC55BXDYpJDOFyVZjKjEAhAaZpJE9xi4EUSVHr5VA/uK4iB6FO0nm0Byie7NXc4Uji1bmFLDAP/PV6PVZFcmZzRpKKjPo9Z6RCF6Ev6mt1q3nOJzrXbAbzrn2qTvTC8v4WAZAq5rkklsrzWeLEAQG+uRpmrmIICgDKhk0LRBZzAUF6smgmAMXSMBSXrqlboyM9yaRfatePyPALb37ZdKfbjvHELvE3YwTQjmCe6rFHSHVcdbT/IAyAkRmEilohzFldfoe7trVdYcLDsF9r0uTakilnHOSQ4WbKVKa9ikVmFYoWyuFISLZpsSE3FTjv+WYvkkgyzq1nGBMx9gWZKs1e3psOnXwTGBpxq7bL3RSVQeiA6FAEjs4ydU+6ZYpM03iyUyoMpenoP6zXKtJ7vGPahcLsZ0AhiFqykzcuwD9Fv5dl3oNbDfaYasYZ4DKdY2WFgKfTDnxdBHaGxnyIGl/5ZrPUtFgxY/jnU8tSbvFJMKZVkeGUQCP/DNl6vs/VqWYSIymmFgONKIcqC1EABs3LmovDY2+rVBJU0boEnL/HcjbFri5rfIi+ZDNie/bqugQ6X/ACRWeCFeihHRoFZOM2aethoUOYz3d3+LBbWktLP3+NgEP+3hUbDB0wEd2B40AgG+Jh4kDnUQ2YSl7XxQl/gtlxvz8AVo4Nr9pW/wN8ExJTMR8FaPNld3swqEKmyA932H2dFb6yehMk6675+qXqFRANf1sy8RhxkUjv1tg8Jo5O+yFBeEL9Ji+YRFpV7PX48MS7Wq/a2wjgXThfc8DWQR+O1K1RU/fjDbRi80Z7ng/ayiocFimPRSAzlF5pkeAhrfAi8cfZHW7lzv5PGFX1i7AOpQHij1mlOluhiCINpPjwpYHLkkqXuk02gQbUTUkI41SUaNad8KYRRvO/u5mTKrQtQmf/+WhkuZ6W3X3SoLL1MY6ajDm+W1MrodD+hrPvz6OICVeeXEzS0ioUzvHI0Vwp3fDBSn6iKsREesscqJGJYs/HX/yXsvggE4XJ+6YTvunQHLCLKxTk+KvahgP+BD593XGrlTBpzZywyAL5fIESpExiZYYYFWCz76aOiZcH5sm6Hk3hDh1DGWMr41WJQT6aO+kjx1TtmJpv2iAybSizy6RHqeMiwvrCgPAO32Rw+isu3/OfkzMYc0jphxBB9mjHeb17dxHuns+ikfOco3oLan4mbo1MUc1J1m0fwIcQBh5T4oxZ4BcSZ5WxBPpCtQUQP0BplZhkzoky46rhCwQ1J2FMqN4iSJf8fBk0AfwvDFHbvbcVYT/s+/jMrNy7MUPPyHCXIXKdWkcTcUqrfmzxToxfWpkzEzxfmUmjPl3JmQi4HiiEnXD4ZO7s1UK+6HXAvOcXb0iQcQ7lDNBo1LAbjxLFrKZCsS67q99n";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
